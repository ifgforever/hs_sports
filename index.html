<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mission Channels</title>
  <link rel="stylesheet" href="/assets/style.css">
</head>
<body>
<header>
  <div class="wrap">
    <nav>
      <div class="navlinks">
        <a class="btn" href="/">Mission Channels</a>
        <a class="btn" href="/browse.html">Browse</a>
        <a class="btn primary" href="/submit.html">Post your channel</a>
      </div>
      <div class="navlinks">
        <a class="btn" href="/login.html" id="loginLink">Login</a>
        <a class="btn" href="/logout.html" id="logoutLink" style="display:none;">Logout</a>
      </div>
    </nav>
  </div>
</header>

<main class="wrap">
  <h1>Support creators with a mission.</h1>
  <p class="small">Post your YouTube channel, explain what you’re trying to accomplish, and let supporters discover and back your mission.</p>

  <div style="display:flex; gap:10px; flex-wrap:wrap; margin:14px 0 18px;">
    <a class="btn primary" href="/submit.html">Post your channel</a>
    <a class="btn" href="/browse.html">Browse missions</a>
  </div>

  <hr>

  <h2>Newest missions</h2>
  <div class="grid" id="grid"></div>
</main>

<script src="/assets/app.js"></script>
<script>
(async () => {
  const user = await APP.getMe().catch(()=>null);
  if (user) { APP.qs("#loginLink").style.display="none"; APP.qs("#logoutLink").style.display="inline-block"; }

  const data = await APP.api("/api/channels", { method:"GET" });
  const grid = APP.qs("#grid");
  grid.innerHTML = (data.channels || []).slice(0,9).map(ch => `
    <div class="card">
      <div class="small">${APP.escapeHtml(ch.category)} ${ch.location ? "• "+APP.escapeHtml(ch.location) : ""}</div>
      <h2>${APP.escapeHtml(ch.display_name)}</h2>
      <div class="small">${APP.escapeHtml(ch.mission).slice(0,140)}${ch.mission.length>140?"…":""}</div>
      <div style="margin-top:10px; display:flex; gap:10px;">
        <a class="btn primary" href="/channel.html?id=${encodeURIComponent(ch.id)}">View mission</a>
        <a class="btn" href="${APP.escapeHtml(ch.youtube_url)}" target="_blank" rel="noopener">YouTube</a>
      </div>
    </div>
  `).join("") || `<div class="card"><div class="small">No channels yet. Post the first mission.</div></div>`;
})();
</script>
  <script>APP.initNav();</script>

</body>
</html>

