<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Missions</title>
</head>
<body>

<h1>Missions</h1>
<div id="user"></div>
<div id="list"></div>

<script src="/app.js"></script>
<script>
(async () => {
  let user;
  try {
    user = await APP.getMe();
  } catch {
    location.href = "/login.html";
    return;
  }

  document.querySelector("#user").textContent =
    "Logged in as @" + user.username;

  const res = await APP.api("/api/channels");
  const list = document.querySelector("#list");

  res.channels.forEach(c => {
    const div = document.createElement("div");
    div.innerHTML = `
      <h3>${c.display_name}</h3>
      <p>${c.mission}</p>
      <small>${c.category || ""} ${c.location || ""}</small>
      <hr>
    `;
    list.appendChild(div);
  });
})();
</script>

</body>
</html>
