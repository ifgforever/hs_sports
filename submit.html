<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Post your channel • Mission Channels</title>
  <link rel="stylesheet" href="/assets/style.css">
</head>
<body>
<header>
  <div class="wrap">
    <nav>
      <div class="navlinks">
        <a class="btn" href="/">Mission Channels</a>
        <a class="btn" href="/browse.html">Browse</a>
        <a class="btn primary" href="/submit.html">Post your channel</a>
      </div>
      <div class="navlinks">
        <a class="btn" href="/login.html" id="loginLink">Login</a>
        <a class="btn" href="/logout.html" id="logoutLink" style="display:none;">Logout</a>
      </div>
    </nav>
  </div>
</header>

<main class="wrap">
  <h1>Post your channel</h1>

  <div class="card">
    <div class="small" id="status"></div>

    <label>Display name</label>
    <input id="display_name" placeholder="Ravens Wrestling" />

    <label>YouTube channel URL</label>
    <input id="youtube_url" placeholder="https://www.youtube.com/@YourChannel" />

    <label>Category</label>
    <select id="category">
      <option>High School Sports</option>
      <option>Faith</option>
      <option>Education</option>
      <option>Fitness</option>
      <option>Local Business</option>
      <option>Podcast</option>
      <option>Other</option>
    </select>

    <label>Location (optional)</label>
    <input id="location" placeholder="Palatine, IL / School name" />

    <label>Contact (optional)</label>
    <input id="contact" placeholder="Email, IG handle, website, etc." />

    <label>Mission statement (40+ chars)</label>
    <textarea id="mission" rows="6" placeholder="What are you trying to accomplish?"></textarea>

    <div style="height:10px"></div>
    <button class="btn primary" id="save" type="button">Submit</button>

    <div style="height:10px"></div>
    <div class="small" id="err" style="white-space:pre-wrap;"></div>
  </div>
</main>

<script src="/assets/app.js"></script>
<script>
document.addEventListener("DOMContentLoaded", async () => {
  await APP.initNav();

  const me = await APP.getMe().catch(() => null);
  if (!me) { location.href = "/login.html"; return; }

  const status = document.querySelector("#status");
  const err = document.querySelector("#err");

  status.textContent = "You’re logged in. Post your channel and mission.";
  err.textContent = "";

  document.querySelector("#save").addEventListener("click", async () => {
    err.textContent = "";

    const payload = {
      display_name: document.querySelector("#display_name").value.trim(),
      youtube_url: document.querySelector("#youtube_url").value.trim(),
      category: document.querySelector("#category").value.trim(),
      location: document.querySelector("#location").value.trim(),
      contact: document.querySelector("#contact").value.trim(),
      mission: document.querySelector("#mission").value.trim(),
    };

    // Friendly client-side checks (matches backend rules)
    if (!payload.display_name) return err.textContent = "Display name is required.";
    if (!payload.youtube_url.includes("youtube.com")) return err.textContent = "Use a full YouTube URL (must include youtube.com).";
    if (payload.mission.length < 40) return err.textContent = "Mission must be at least 40 characters.";

    try {
      const res = await APP.api("/api/channels", { method: "POST", body: JSON.stringify(payload) });
      location.href = "/channel.html?id=" + encodeURIComponent(res.id);
    } catch (e) {
      err.textContent = e.message || "Submit failed.";
    }
  });
});
</script>
</body>
</html>
